
åƒè€ƒè³‡æ–™ï¼š
https://www.youtube.com/watch?v=PuZvF2EyfBM
https://www.hellointerview.com/learn/system-design/deep-dives/elasticsearch

ä¸­æ–‡å½±ç‰‡
https://www.youtube.com/watch?v=dVUMqi5knuo


## **ğŸ’¡ ä¸€ã€Elasticsearch æ˜¯ä»€éº¼ï¼Ÿ**

> **Elasticsearchï¼ˆç°¡ç¨± ESï¼‰**
> æ˜¯ä¸€å€‹åŸºæ–¼ **Lucene** çš„**åˆ†æ•£å¼å…¨æ–‡æª¢ç´¢èˆ‡è³‡æ–™åˆ†æå¼•æ“**ã€‚

ğŸ“¦ å®ƒæœ€åˆç”± Elastic.co é–‹ç™¼ï¼Œ

è¢«å»£æ³›ç”¨æ–¼ï¼š

- å…¨æ–‡æœå°‹ï¼ˆFull-text Searchï¼‰    
- æ—¥èªŒåˆ†æï¼ˆLog Analyticsï¼‰
- å•†æ¥­æ™ºæ…§ï¼ˆBusiness Intelligence, BIï¼‰
- å¯¦æ™‚ç›£æ§ï¼ˆObservability, APMï¼‰

ğŸ‘‰ é€šå¸¸æ­é…ï¼š  

> **Elasticsearch + Logstash + Kibana = ELK Stack**
> ï¼ˆç¾åœ¨æ–°ç‰ˆå« **Elastic Stack**ï¼‰

## **ğŸ§± äºŒã€ES çš„æ ¸å¿ƒæ¦‚å¿µçµæ§‹**

| **æ¦‚å¿µ**           | **é¡ä¼¼æ–¼**            | **èªªæ˜**                      |
| ---------------- | ------------------ | --------------------------- |
| **Indexï¼ˆç´¢å¼•ï¼‰**    | è³‡æ–™åº«ï¼ˆDatabaseï¼‰      | ç”¨ä¾†å„²å­˜ä¸€é¡å‹çš„æ–‡ä»¶                  |
| **Documentï¼ˆæ–‡ä»¶ï¼‰** | è³‡æ–™è¡¨ä¸­çš„ä¸€ç­†è³‡æ–™ï¼ˆRowï¼‰     | JSON æ ¼å¼çš„è³‡æ–™å–®ä½                |
| **Fieldï¼ˆæ¬„ä½ï¼‰**    | è³‡æ–™è¡¨çš„æ¬„ä½ï¼ˆColumnï¼‰     | æ–‡ä»¶çš„å±¬æ€§åç¨±                     |
| **Mapping**      | Schema             | å®šç¾©æ¬„ä½çš„å‹åˆ¥ã€åˆ†æå™¨                 |
| **Analyzer**     | Tokenizer + Filter | è² è²¬å°‡æ–‡å­—åˆ‡åˆ†ã€æ­£è¦åŒ–ã€å»ºç«‹å€’æ’ç´¢å¼•          |
| **Shard**        | è³‡æ–™åˆ†ç‰‡ï¼ˆPartitionï¼‰    | ä¸€å€‹ Index å¯åˆ†æˆå¤šå€‹ Shardï¼Œå¯¦ç¾æ°´å¹³æ“´å±• |
| **Replica**      | è³‡æ–™å‰¯æœ¬               | å‚™æ´ç”¨ï¼Œæå‡å¯ç”¨æ€§èˆ‡æŸ¥è©¢æ•ˆç‡              |

---

## **âš™ï¸ ä¸‰ã€Elasticsearch çš„é‹ä½œåŸç†**

### **1ï¸âƒ£ è³‡æ–™å¯«å…¥ï¼ˆIndexingï¼‰**

```
Client â†’ Elasticsearch Node
        â†“
Analyzer åˆ†æï¼ˆæ–·è©ã€éæ¿¾ï¼‰
        â†“
å»ºç«‹å€’æ’ç´¢å¼•ï¼ˆInverted Indexï¼‰
        â†“
å„²å­˜åœ¨ Shard ä¸­
```

> âœ… å€’æ’ç´¢å¼•ï¼ˆInverted Indexï¼‰ =
> ä¸€ç¨®ã€Œå¾å­—è©æ‰¾æ–‡ä»¶ã€çš„è³‡æ–™çµæ§‹ã€‚

ğŸ’¬ èˆ‰ä¾‹ï¼š

```
"apple" å‡ºç¾åœ¨æ–‡ä»¶ 1, 5, 7
"banana" å‡ºç¾åœ¨æ–‡ä»¶ 2, 5
```

### **2ï¸âƒ£ è³‡æ–™æœå°‹ï¼ˆQueryingï¼‰**

```
User Query â†’ Analyzerï¼ˆåˆ†ææŸ¥è©¢å­—ï¼‰ Â 

Â  Â  Â  Â  Â  â†’ åœ¨å€’æ’ç´¢å¼•ä¸­æ¯”å°è©å½™ Â 

Â  Â  Â  Â  Â  â†’ è¿”å›ç¬¦åˆçš„æ–‡ä»¶ + ç›¸é—œåº¦ï¼ˆscoreï¼‰
```

> ES æœƒæ ¹æ“š **TF-IDF / BM25** ç­‰æ¼”ç®—æ³•è¨ˆç®—ã€Œç›¸é—œåº¦åˆ†æ•¸ã€ã€‚

---

## **ğŸ§  å››ã€ES çš„å¼·é …**

| **é¡åˆ¥**                          | **èƒ½åŠ›**             |
| ------------------------------- | ------------------ |
| ğŸ” **å…¨æ–‡æª¢ç´¢**                     | æ–‡å­—åˆ‡è©ã€æ¨¡ç³Šæœå°‹ã€ç›¸ä¼¼åº¦æ¯”å°    |
| âš¡ **å³æ™‚æŸ¥è©¢**                      | ç§’ç´šå›æ‡‰ï¼Œæ”¯æ´å¤§è¦æ¨¡è³‡æ–™       |
| ğŸ“ˆ **èšåˆåˆ†æï¼ˆAggregationï¼‰**        | åˆ†çµ„ã€çµ±è¨ˆã€è¨ˆæ•¸ã€å¹³å‡å€¼ã€ç›´æ–¹åœ–   |
| ğŸ§© **çµæ§‹åŒ– + éçµæ§‹åŒ–è³‡æ–™æ··ç”¨**           | JSON æ ¼å¼éˆæ´»          |
| ğŸ” **æ°´å¹³æ“´å±•ï¼ˆHorizontal Scalingï¼‰** | Shard + Replica æ¶æ§‹ |
| ğŸ§± **é«˜å¯ç”¨æ€§ï¼ˆHigh Availabilityï¼‰**  | ç¯€é»åˆ†ä½ˆå¼åŒæ­¥ã€å®¹éŒ¯æ©Ÿåˆ¶       |

---

## **ğŸ§© äº”ã€ES çš„åˆ†æ•£å¼æ¶æ§‹**

```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      Client (API)    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Coordinating Node   â”‚ â† è«‹æ±‚å”èª¿è€…
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â–¼              â–¼              â–¼
[Data Node1]   [Data Node2]   [Data Node3]
   â”œâ”€ Shard 1     â”œâ”€ Shard 2     â”œâ”€ Shard 3
   â””â”€ Replica 3    â””â”€ Replica 1   â””â”€ Replica 2
```

ğŸ§  èªªæ˜ï¼š

- **Client Node**ï¼šæ¥æ”¶æŸ¥è©¢æˆ–å¯«å…¥è«‹æ±‚
- **Coordinating Node**ï¼šæ‹†åˆ†æŸ¥è©¢ä¸¦æ•´åˆçµæœ
- **Data Node**ï¼šå¯¦éš›å„²å­˜è³‡æ–™ã€ç´¢å¼•èˆ‡åˆ†ç‰‡
- **Master Node**ï¼šç®¡ç†å¢é›†ã€åˆ†ç‰‡åˆ†é…ã€ç¯€é»å¥åº·æª¢æŸ¥

---

## **ğŸ” å…­ã€æœå°‹æ–¹å¼é¡å‹**

|**æŸ¥è©¢é¡å‹**|**åŠŸèƒ½**|**ç¯„ä¾‹**|
|---|---|---|
|**Term Query**|ç²¾æº–æ¯”å°ï¼ˆä¸æ–·è©ï¼‰|æ‰¾ â€œstatus: activeâ€|
|**Match Query**|å…¨æ–‡æ¯”å°ï¼ˆæœƒæ–·è©ï¼‰|æ‰¾ â€œå¿«é€Ÿæœå°‹â€|
|**Bool Query**|è¤‡åˆæ¢ä»¶|must + should + filter|
|**Range Query**|ç¯„åœæŸ¥è©¢|price: 100â€“500|
|**Aggregation**|èšåˆçµ±è¨ˆ|å¹³å‡åƒ¹æ ¼ã€æœ€å¤§æœ€å°å€¼|

ğŸ’¡ ES çš„æŸ¥è©¢èªè¨€æ˜¯ **DSLï¼ˆDomain Specific Languageï¼‰**ï¼Œ
ä»¥ JSON æ ¼å¼æ’°å¯«ï¼Œä¾‹å¦‚ï¼š

```json

GET /products/_search
{
  "query": {
    "match": { "name": "headphones" }
  },
  "aggs": {
    "avg_price": { "avg": { "field": "price" } }
  }
}

```

---

## **ğŸ“¦ ä¸ƒã€å¸¸è¦‹ä½¿ç”¨å ´æ™¯**

|**é¡å‹**|**å¯¦ä¾‹**|
|---|---|
|ğŸ” æœå°‹å¼•æ“|ç¶²ç«™å…¨æ–‡æœå°‹ã€ç”¢å“æœå°‹ã€æ¨¡ç³Šæ¯”å°|
|ğŸ“Š æ—¥èªŒåˆ†æ|ELK Stackï¼ˆLogstash â†’ Elasticsearch â†’ Kibanaï¼‰|
|ğŸ“ˆ è³‡æ–™åˆ†æ|å³æ™‚çµ±è¨ˆã€å ±è¡¨èšåˆ|
|ğŸ§  æ™ºèƒ½æ¨è–¦|æ ¹æ“šä½¿ç”¨è€…æŸ¥è©¢è©å½™æ‰¾ç›¸ä¼¼çµæœ|
|ğŸ•µï¸ ç›£æ§ç³»çµ±|æ”¶é›† Metricsã€Traceã€Logs æ•´åˆæŸ¥è©¢|

---

## **âš ï¸ å…«ã€Elasticsearch çš„æŒ‘æˆ°èˆ‡ç¼ºé»**

|**å•é¡Œ**|**èªªæ˜**|
|---|---|
|ğŸ§® **è³‡æ–™ä¸€è‡´æ€§å¼±ï¼ˆEventually Consistentï¼‰**|åˆ†æ•£å¼ç³»çµ±çš„åŒæ­¥å»¶é²å¯èƒ½é€ æˆçŸ­æš«ä¸ä¸€è‡´|
|ğŸ’¾ **å„²å­˜ç©ºé–“æ¶ˆè€—å¤§**|å€’æ’ç´¢å¼•èˆ‡å‰¯æœ¬ä½”ç”¨å¤§é‡ç£ç¢Ÿ|
|âš™ï¸ **å¯«å…¥æ•ˆèƒ½ä¸å¦‚æŸ¥è©¢å¿«**|å»ºç´¢å¼•ã€æ–·è©ã€å£“ç¸®æˆæœ¬é«˜|
|ğŸ” **è¤‡é›œæŸ¥è©¢èª¿æ ¡é›£**|Mappingã€Analyzer ä¸ç•¶æœƒé€ æˆæœå°‹ä¸æº–|
|ğŸ§© **é›†ç¾¤ç¶­è­·è¤‡é›œ**|Shard/Replica éå¤šæ˜“å½±éŸ¿æ•ˆèƒ½|
|ğŸ§  **å­¸ç¿’æ›²ç·šé«˜**|DSL èªæ³•èˆ‡æŸ¥è©¢é‚è¼¯éœ€ç†Ÿæ‚‰|

---

## **ğŸ§® ä¹ã€èˆ‡è³‡æ–™åº«æ¯”è¼ƒï¼ˆSQL vs Elasticsearchï¼‰**

| **é¢å‘**   | **RDBMS (SQL)** | **Elasticsearch** |
| -------- | --------------- | ----------------- |
| è³‡æ–™å‹åˆ¥     | çµæ§‹åŒ–ï¼ˆè¡¨æ ¼ï¼‰         | JSONï¼ˆåŠçµæ§‹åŒ–ï¼‰        |
| æŸ¥è©¢èªè¨€     | SQL             | DSLï¼ˆJSONï¼‰         |
| å¯«å…¥æ•ˆèƒ½     | é«˜               | ä¸­ï¼ˆéœ€å»ºç«‹ç´¢å¼•ï¼‰          |
| æŸ¥è©¢æ•ˆèƒ½     | ç²¾ç¢ºæŸ¥è©¢å¿«           | æ¨¡ç³ŠæŸ¥è©¢å¿«             |
| äº‹å‹™ï¼ˆACIDï¼‰ | æ”¯æ´              | å¼±ä¸€è‡´æ€§              |
| æ°´å¹³æ“´å±•     | å›°é›£              | å¤©ç”Ÿæ”¯æ´              |
| é©ç”¨å ´æ™¯     | CRUD æ¥­å‹™ç³»çµ±       | æœå°‹ã€åˆ†æã€å³æ™‚å ±è¡¨        |

---

## **ğŸ”§ åã€èˆ‡å…¶ä»–æœå°‹ç³»çµ±æ¯”è¼ƒ**

|**ç³»çµ±**|**èªªæ˜**|**ç‰¹è‰²**|
|---|---|---|
|**Elasticsearch**|åŸºæ–¼ Luceneï¼Œæœ€æµè¡Œ|åˆ†æ•£å¼ã€REST APIã€æ“´å±•æ€§å¼·|
|**Solr**|æ—©æœŸ Lucene å¹³å°|XML-based é…ç½®ã€è¼ƒå‚³çµ±|
|**OpenSearch**|AWS fork ç‰ˆæœ¬|é–‹æºæŒçºŒé–‹ç™¼|
|**Meilisearch / Typesense**|è¼•é‡æœå°‹å¼•æ“|ç°¡å–®éƒ¨ç½²ã€å°å°ˆæ¡ˆé©ç”¨|

---

## **âœ… åä¸€ã€ä¸€å¥è©±ç¸½çµ**

> ğŸ” **Elasticsearch æ˜¯è³‡æ–™ä¸–ç•Œçš„ Googleã€‚**

- > ç”¨å€’æ’ç´¢å¼•è®“æœå°‹å¿«å¾—åƒæŸ¥å­—å…¸
- > ç”¨åˆ†ç‰‡ï¼ˆShardï¼‰è®“å¢é›†èƒ½ç„¡é™æ°´å¹³æ“´å±•
- > åŒæ™‚å…¼å…·æœå°‹å¼•æ“èˆ‡è³‡æ–™åˆ†æåŠŸèƒ½>   

> ğŸ’¬ å¯¦å‹™æ‡‰ç”¨ä¸­ï¼š

- > RDBMS è² è²¬**å„²å­˜**ï¼ˆdata of recordï¼‰
- > Elasticsearch è² è²¬**æœå°‹èˆ‡åˆ†æ**ï¼ˆdata for queryï¼‰
